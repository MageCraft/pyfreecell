<?xml version="1.0" encoding="utf-8"?>
<mx:WindowedApplication xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute">
	<mx:VBox id="main" width="100%" height="100%">
		<mx:HBox width="100%">
			<mx:Button id="btnList" label="list" click="list()"/>
			<mx:Button id="btnAdd" label="add" click="add()"/>
			<mx:Button id="btnDelete" label="delete" click="del()"/>
			<mx:Button id="btnUpdate" label="update" click="update()"/>
		</mx:HBox>
		<mx:HRule width="100%"/>
		<mx:TextArea id="txtResults" editable="false" width="100%" height="100%"/>
	</mx:VBox>
	<mx:Script>
		<![CDATA[
			private var _tasks:Array;
			
			private function list():void {
				var loader:URLLoader = new URLLoader();
				var req:URLRequest = new URLRequest();
				req.url = 'http://localhost:8080/list';
				req.method = URLRequestMethod.GET;
				var resultHandler:Function = function(event:Event):void {
					var xml:String = URLLoader(event.target).data;
					var xmlDoc:XML = new XML(xml);
					var tasks:XMLList = xmlDoc.task;
					_tasks = new Array;
					
					for each(var task:XML in tasks) {
						var o:Object = new Object;
						o.key = task.@key;
						o.content = task.@content;
						_tasks.push(o);	
					}
					
					txtResults.text += URLLoader(event.target).data + '\n';
					
				}
				loader.addEventListener(Event.COMPLETE, resultHandler,false,0,true);
				loader.load(req);
				
			}
			
			private function add():void {
				var loader:URLLoader = new URLLoader();
				loader.dataFormat = URLLoaderDataFormat.VARIABLES;
				var req:URLRequest = new URLRequest();
				req.url = 'http://localhost:8080/add';
				req.method = URLRequestMethod.POST;
				var vars:URLVariables = new URLVariables;								
				vars.content = 'My Task ' + Math.round(Math.random()*1000);
				req.data = vars;
				var resultHandler:Function = function(event:Event):void {
					txtResults.text += 'New Task Created, key is ' + URLLoader(event.target).data.key + '\n';
				}
				loader.addEventListener(Event.COMPLETE, resultHandler,false,0,true);
				loader.load(req);			
			}
			
			private function del():void {
				var loader:URLLoader = new URLLoader();				
				var req:URLRequest = new URLRequest();
				req.url = 'http://localhost:8080/delete';
				req.method = URLRequestMethod.POST;
				var vars:URLVariables = new URLVariables;
				vars.key = _tasks[_tasks.length-1].key;
				req.data = vars;
				var resultHandler:Function = function(event:Event):void {
					txtResults.text += URLLoader(event.target).data + '\n';
				}	
				loader.addEventListener(Event.COMPLETE, resultHandler,false,0,true);
				loader.load(req);
			}
			
			private function update():void {
				var loader:URLLoader = new URLLoader();				
				var req:URLRequest = new URLRequest();
				req.url = 'http://localhost:8080/update';
				req.method = URLRequestMethod.POST;
				var vars:URLVariables = new URLVariables;
				var task:Object = _tasks[_tasks.length-1];
				vars.key = task.key;
				vars.content = task.content + ' updated';
				req.data = vars;
				var resultHandler:Function = function(event:Event):void {
					txtResults.text += URLLoader(event.target).data + '\n';
				}	
				loader.addEventListener(Event.COMPLETE, resultHandler,false,0,true);
				loader.load(req);
			}
		]]>
	</mx:Script>	
</mx:WindowedApplication>
